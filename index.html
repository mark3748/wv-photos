<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Wellness Photos">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#09099d">

    <!-- PWA Icons -->
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='bg' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%233498db'/%3E%3Cstop offset='100%25' style='stop-color:%232980b9'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='20' fill='url(%23bg)'/%3E%3Ctext x='50' y='65' font-family='Arial' font-size='45' text-anchor='middle' fill='white'%3Eüì∑%3C/text%3E%3C/svg%3E">
    <link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">
    <!-- Web App Manifest -->
    <link rel="manifest"
        href="data:application/json,%7B%22name%22%3A%22Wellness%20Photo%20Manager%22%2C%22short_name%22%3A%22Wellness%20Photos%22%2C%22description%22%3A%22Capture%20and%20organize%20inspection%20photos%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23667eea%22%2C%22theme_color%22%3A%22%233498db%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22data%3Aimage/svg%2Bxml%2C%253Csvg%2520xmlns%253D%2527http%253A//www.w3.org/2000/svg%2527%2520viewBox%253D%25270%25200%2520192%2520192%2527%253E%253Cdefs%253E%253ClinearGradient%2520id%253D%2527bg%2527%2520x1%253D%25270%252525%2527%2520y1%253D%25270%252525%2527%2520x2%253D%2527100%252525%2527%2520y2%253D%2527100%252525%2527%253E%253Cstop%2520offset%253D%25270%252525%2527%2520style%253D%2527stop-color%253A%25233498db%2527/%253E%253Cstop%2520offset%253D%2527100%252525%2527%2520style%253D%2527stop-color%253A%25232980b9%2527/%253E%253C/linearGradient%253E%253C/defs%253E%253Crect%2520width%253D%2527192%2527%2520height%253D%2527192%2527%2520rx%253D%252742%2527%2520fill%253D%2527url%2528%2523bg%2529%2527/%253E%253Ctext%2520x%253D%252796%2527%2520y%253D%2527130%2527%2520font-family%253D%2527Arial%2527%2520font-size%253D%252785%2527%2520text-anchor%253D%2527middle%2527%2520fill%253D%2527white%2527%253E%25F0%259F%2593%25B7%253C/text%253E%253C/svg%253E%22%2C%22sizes%22%3A%22192x192%22%2C%22type%22%3A%22image/svg%2Bxml%22%7D%2C%7B%22src%22%3A%22data%3Aimage/svg%2Bxml%2C%253Csvg%2520xmlns%253D%2527http%253A//www.w3.org/2000/svg%2527%2520viewBox%253D%25270%25200%2520512%2520512%2527%253E%253Cdefs%253E%253ClinearGradient%2520id%253D%2527bg%2527%2520x1%253D%25270%252525%2527%2520y1%253D%25270%252525%2527%2520x2%253D%2527100%252525%2527%2520y2%253D%2527100%252525%2527%253E%253Cstop%2520offset%253D%25270%252525%2527%2520style%253D%2527stop-color%253A%25233498db%2527/%253E%253Cstop%2520offset%253D%2527100%252525%2527%2520style%253D%2527stop-color%253A%25232980b9%2527/%253E%253C/linearGradient%253E%253C/defs%253E%253Crect%2520width%253D%2527512%2527%2520height%253D%2527512%2527%2520rx%253D%2527112%2527%2520fill%253D%2527url%2528%2523bg%2529%2527/%253E%253Ctext%2520x%253D%2527256%2527%2520y%253D%2527340%2527%2520font-family%253D%2527Arial%2527%2520font-size%253D%2527220%2527%2520text-anchor%253D%2527middle%2527%2520fill%253D%2527white%2527%253E%25F0%259F%2593%25B7%253C/text%253E%253C/svg%253E%22%2C%22sizes%22%3A%22512x512%22%2C%22type%22%3A%22image/svg%2Bxml%22%7D%5D%7D">

    <title>Wellness Photo Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #09099d 0%, #e825ba 100%);
            min-height: 100vh;
            padding: 10px;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            min-height: calc(100vh - 20px);
        }

        .header {
            background: linear-gradient(45deg, #09099d, #e825ba);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .form-section {
            padding: 30px 20px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        input,
        select {
            width: 100%;
            padding: 16px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 18px;
            transition: border-color 0.3s;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #09099d;
        }

        .photo-upload {
            border: 3px dashed #09099d;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-bottom: 20px;
            touch-action: manipulation;
        }

        .photo-upload:hover,
        .photo-upload:active {
            background-color: #f8f9ff;
        }

        .photo-upload.dragover {
            background-color: #e3f2fd;
            border-color: #2196f3;
        }

        .upload-icon {
            font-size: 64px;
            color: #09099d;
            margin-bottom: 15px;
        }

        .btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .btn:hover,
        .btn:active {
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .photos-section {
            padding: 0 20px 20px;
        }

        .photos-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }

        .photos-count {
            color: #7f8c8d;
            font-weight: 600;
        }

        .download-btn {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            padding: 10px 20px;
            width: auto;
            font-size: 14px;
        }

        .photo-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .photo-thumb {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
            border: 2px solid #e0e0e0;
        }

        .photo-info {
            flex: 1;
        }

        .photo-filename {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .photo-details {
            font-size: 12px;
            color: #7f8c8d;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 12px 16px;
            cursor: pointer;
            font-size: 16px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .status {
            text-align: center;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: 600;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 480px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }

            .header {
                padding: 20px 15px;
            }

            .form-section {
                padding: 20px 15px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üì∏ Wellness Photo Manager</h1>
            <p>Capture, organize, and download your inspection photos</p>
            <p>***</p>
            <p>Note: Refreshing page will lose all photos that have not been downloaded. The names will be saved but you
                will need to re-upload the photos.</p>
        </div>

        <div class="form-section">
            <div class="input-group">
                <label for="restaurantNumber">Restaurant Number</label>
                <input type="number" id="restaurantNumber" placeholder="e.g., 1916" required>
            </div>

            <div class="input-group">
                <label for="location">Location</label>
                <input type="text" id="location" placeholder="e.g., Kitchen, Dining Room, Office" required>
            </div>

            <div class="input-group">
                <label for="equipmentType">Equipment Type</label>
                <select id="equipmentType" required>
                    <option value="">Select equipment type</option>
                    <option value="PatchPanel">Patch Panel (Front/Rear DTT)</option>
                    <option value="NetworkEquip">Network Equipment</option>
                    <option value="FiberNID">Fiber/NID</option>
                    <option value="FiberLabels">Fiber Labels</option>
                    <option value="LAPC_Powervar">LAPC / Powervar 800</option>
                    <option value="Desktop">Desktop (Monitor/Printers)</option>
                    <option value="USB_WallPort">USB Wall Port</option>
                    <option value="NetworkJacks">CFA Access Network Jacks</option>
                    <option value="Register">Register</option>
                    <option value="KPS">KPS Monitor</option>
                    <option value="FullRegister">Full Register Station</option>
                    <option value="BBU">BBU (Battery Backup)</option>
                    <option value="PowerNetworkUnder">Power/Network (Under Counter)</option>
                    <option value="CounterCustomer">Counter (Customer Side)</option>
                    <option value="Wifi_AP">Wifi Antenna / Access Point</option>
                    <option value="Unique">Unique/Unusual Equipment</option>
                    <option value="NewEquip">New Equipment / Wiring Before</option>
                </select>
            </div>

            <div class="input-group">
                <label for="beforeAfter">Before/After</label>
                <select id="beforeAfter" required>
                    <option value="">Select status</option>
                    <option value="Before">Before</option>
                    <option value="After">After</option>
                </select>
            </div>

            <div class="photo-upload" id="photoUpload">
                <div class="upload-icon">üì∑</div>
                <p><strong>Tap to Take Photo</strong></p>
                <p style="font-size: 16px; color: #7f8c8d; margin-top: 10px;">
                    Camera will open automatically
                </p>
                <input type="file" id="photoInput" accept="image/*" capture="environment" style="display: none;">
            </div>

            <button class="btn" id="addPhotoBtn" disabled>Add Photo</button>
        </div>

        <div class="photos-section" id="photosSection">
            <div class="photos-header">
                <h3>üìÅ Captured Photos</h3>
                <span class="photos-count" id="photosCount">0 photos</span>
            </div>
            <div id="photosList"></div>
            <button class="btn download-btn hidden" id="downloadBtn">
                üì• Download All Photos (ZIP)
            </button>
            <button class="btn delete-btn hidden" id="clearAllBtn"
                style="margin-top: 10px; width: 100%; background: #e74c3c;">
                üóëÔ∏è Clear All Photos
            </button>
        </div>

        <div id="status"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        class PhotoManager {
            constructor() {
                this.photos = [];
                this.initializeElements();
                this.loadState();
                this.attachEventListeners();
                this.updateUI();
            }

            initializeElements() {
                this.restaurantNumber = document.getElementById('restaurantNumber');
                this.location = document.getElementById('location');
                this.equipmentType = document.getElementById('equipmentType');
                this.beforeAfter = document.getElementById('beforeAfter');
                this.photoUpload = document.getElementById('photoUpload');
                this.photoInput = document.getElementById('photoInput');
                this.addPhotoBtn = document.getElementById('addPhotoBtn');
                this.photosList = document.getElementById('photosList');
                this.photosCount = document.getElementById('photosCount');
                this.downloadBtn = document.getElementById('downloadBtn');
                this.clearAllBtn = document.getElementById('clearAllBtn');
                if (!this.clearAllBtn) console.error('Clear All Button not found!');
                this.status = document.getElementById('status');
            }

            attachEventListeners() {
                // Form validation and auto-save
                const formInputs = [this.restaurantNumber, this.location, this.equipmentType, this.beforeAfter];
                formInputs.forEach(input => {
                    input.addEventListener('input', () => {
                        this.validateForm();
                        this.saveState();
                    });
                    input.addEventListener('change', () => {
                        this.validateForm();
                        this.saveState();
                    });
                });

                // Photo upload
                this.photoUpload.addEventListener('click', () => this.photoInput.click());
                this.photoInput.addEventListener('change', (e) => this.handleFileSelect(e));

                // Drag and drop
                this.photoUpload.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    this.photoUpload.classList.add('dragover');
                });

                this.photoUpload.addEventListener('dragleave', () => {
                    this.photoUpload.classList.remove('dragover');
                });

                this.photoUpload.addEventListener('drop', (e) => {
                    e.preventDefault();
                    this.photoUpload.classList.remove('dragover');
                    this.handleFileSelect(e);
                });

                // Add photo button
                this.addPhotoBtn.addEventListener('click', () => this.addCurrentPhoto());

                // Download button
                this.downloadBtn.addEventListener('click', () => this.downloadPhotos());

                // Clear all button
                if (this.clearAllBtn) {
                    this.clearAllBtn.addEventListener('click', () => this.clearAllPhotos());
                }
            }

            validateForm() {
                const isValid = this.restaurantNumber.value &&
                    this.location.value &&
                    this.equipmentType.value &&
                    this.beforeAfter.value &&
                    this.photoInput.files.length > 0;

                this.addPhotoBtn.disabled = !isValid;
            }

            handleFileSelect(event) {
                const files = event.target ? event.target.files : event.dataTransfer.files;
                if (files.length > 0) {
                    const file = files[0];
                    if (file.type.startsWith('image/')) {
                        this.validateForm();
                        this.showStatus('Photo selected: ' + file.name, 'success');
                    } else {
                        this.showStatus('Please select an image file', 'error');
                    }
                }
            }

            generateFilename(restaurantNum, location, equipment, beforeAfter, extension, index = '') {
                // Format restaurant number with leading zeros (5 digits)
                const formattedRestaurant = restaurantNum.toString().padStart(5, '0');

                // Clean up values (remove spaces)
                const cleanLocation = location.replace(/\s+/g, '');
                const cleanEquipment = equipment.replace(/\s+/g, '');
                const cleanBeforeAfter = beforeAfter.replace(/\s+/g, '');

                // Add index suffix if provided
                const suffix = index ? `_${index}` : '';

                return `${formattedRestaurant}-${cleanLocation}-${cleanEquipment}-${cleanBeforeAfter}${suffix}.${extension}`;
            }

            resizeImage(file, maxWidth = 1280, quality = 0.8) {
                return new Promise((resolve, reject) => {
                    if (!file.type.match(/image.*/)) {
                        resolve(file);
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            let width = img.width;
                            let height = img.height;

                            if (width > maxWidth || height > maxWidth) {
                                if (width > height) {
                                    height = Math.round(height * (maxWidth / width));
                                    width = maxWidth;
                                } else {
                                    width = Math.round(width * (maxWidth / height));
                                    height = maxWidth;
                                }
                            }

                            const canvas = document.createElement('canvas');
                            canvas.width = width;
                            canvas.height = height;

                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, width, height);

                            canvas.toBlob((blob) => {
                                if (!blob) {
                                    reject(new Error('Canvas is empty'));
                                    return;
                                }
                                const newFile = new File([blob], file.name.replace(/\.[^/.]+$/, "") + ".jpg", {
                                    type: 'image/jpeg',
                                    lastModified: Date.now()
                                });
                                resolve(newFile);
                            }, 'image/jpeg', quality);
                        };
                        img.onerror = reject;
                        img.src = e.target.result;
                    };
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            }

            async addCurrentPhoto() {
                const originalFile = this.photoInput.files[0];
                if (!originalFile) return;

                // Disable button and show status
                this.addPhotoBtn.disabled = true;
                this.showStatus('Processing image...', 'success');

                try {
                    const file = await this.resizeImage(originalFile);

                    const restaurantNum = this.restaurantNumber.value;
                    const location = this.location.value;
                    const equipment = this.equipmentType.value;
                    const beforeAfter = this.beforeAfter.value;

                    // Get file extension - we force jpg now
                    const extension = 'jpg';

                    // Check for duplicate filenames and add index if needed
                    let index = '';
                    let baseFilename = this.generateFilename(restaurantNum, location, equipment, beforeAfter, extension);
                    let filename = baseFilename;
                    let counter = 1;

                    while (this.photos.some(photo => photo.filename === filename)) {
                        index = counter.toString();
                        filename = this.generateFilename(restaurantNum, location, equipment, beforeAfter, extension, index);
                        counter++;
                    }

                    // Create photo object
                    const photoData = {
                        id: Date.now(),
                        file: file,
                        filename: filename,
                        restaurantNumber: restaurantNum,
                        location: location,
                        equipmentType: equipment,
                        beforeAfter: beforeAfter,
                        timestamp: new Date().toLocaleString()
                    };

                    this.photos.push(photoData);
                    this.updateUI();
                    this.resetForm();
                    this.saveState();
                    this.showStatus(`Photo added: ${filename}`, 'success');
                } catch (error) {
                    console.error(error);
                    this.showStatus('Error processing photo: ' + error.message, 'error');
                    this.addPhotoBtn.disabled = false;
                }
            }

            resetForm() {
                this.photoInput.value = '';
                this.addPhotoBtn.disabled = true;
            }

            deletePhoto(photoId) {
                this.photos = this.photos.filter(photo => photo.id !== photoId);
                this.updateUI();
                this.saveState();
                this.showStatus('Photo deleted', 'success');
            }

            clearAllPhotos() {
                if (this.photos.length === 0) return;

                if (confirm('Are you sure you want to delete ALL photos? This action cannot be undone.')) {
                    this.photos = [];
                    this.updateUI();
                    this.saveState();
                    this.showStatus('All photos deleted', 'success');
                }
            }

            updateUI() {
                // Update photos count
                this.photosCount.textContent = `${this.photos.length} photo${this.photos.length !== 1 ? 's' : ''}`;

                // Show/hide download button
                // Show/hide download button
                if (this.photos.length > 0) {
                    if (this.downloadBtn) this.downloadBtn.classList.remove('hidden');
                    if (this.clearAllBtn) this.clearAllBtn.classList.remove('hidden');
                } else {
                    if (this.downloadBtn) this.downloadBtn.classList.add('hidden');
                    if (this.clearAllBtn) this.clearAllBtn.classList.add('hidden');
                }

                // Update photos list
                if (this.photosList) {
                    this.photosList.innerHTML = '';
                    this.photos.forEach(photo => {
                        const photoItem = this.createPhotoItem(photo);
                        this.photosList.appendChild(photoItem);
                    });
                }
            }

            createPhotoItem(photo) {
                const item = document.createElement('div');
                item.className = 'photo-item';

                // Create thumbnail or placeholder
                const thumb = document.createElement('div');
                thumb.className = 'photo-thumb';

                if (photo.file) {
                    const img = document.createElement('img');
                    img.className = 'photo-thumb';
                    img.src = URL.createObjectURL(photo.file);
                    item.appendChild(img);
                } else {
                    thumb.style.display = 'flex';
                    thumb.style.alignItems = 'center';
                    thumb.style.justifyContent = 'center';
                    thumb.style.backgroundColor = '#f8f9fa';
                    thumb.style.border = '2px dashed #dee2e6';
                    thumb.style.fontSize = '24px';
                    thumb.textContent = 'üì∑';
                    item.appendChild(thumb);
                }

                // Create info section
                const info = document.createElement('div');
                info.className = 'photo-info';
                const statusText = photo.file ? '' : '<br><small style="color: #e74c3c;">‚ö†Ô∏è Photo file not available after refresh</small>';
                info.innerHTML = `
                    <div class="photo-filename">${photo.filename}</div>
                    <div class="photo-details">
                        ${photo.restaurantNumber} ‚Ä¢ ${photo.location} ‚Ä¢ ${photo.equipmentType} ‚Ä¢ ${photo.beforeAfter}<br>
                        Added: ${photo.timestamp}${statusText}
                    </div>
                `;

                // Create delete button
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = 'üóëÔ∏è';
                deleteBtn.onclick = () => this.deletePhoto(photo.id);

                item.appendChild(info);
                item.appendChild(deleteBtn);

                return item;
            }

            async downloadPhotos() {
                if (this.photos.length === 0) return;

                try {
                    const zip = new JSZip();

                    // Add each photo to the zip
                    for (const photo of this.photos) {
                        zip.file(photo.filename, photo.file);
                    }

                    // Generate zip file
                    const content = await zip.generateAsync({ type: 'blob' });

                    // Create download link
                    const restaurantNum = this.photos[0].restaurantNumber.padStart(5, '0');
                    const timestamp = new Date().toISOString().split('T')[0];
                    const zipFilename = `WellnessPhotos_${restaurantNum}_${timestamp}.zip`;

                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(content);
                    link.download = zipFilename;
                    link.click();

                    this.showStatus(`Downloaded: ${zipFilename}`, 'success');
                } catch (error) {
                    this.showStatus('Error creating download: ' + error.message, 'error');
                }
            }

            showStatus(message, type) {
                this.status.innerHTML = `<div class="status ${type}">${message}</div>`;
                setTimeout(() => {
                    this.status.innerHTML = '';
                }, 3000);
            }

            saveState() {
                try {
                    const state = {
                        formData: {
                            restaurantNumber: this.restaurantNumber.value,
                            location: this.location.value,
                            equipmentType: this.equipmentType.value,
                            beforeAfter: this.beforeAfter.value
                        },
                        photos: this.photos.map(photo => ({
                            id: photo.id,
                            filename: photo.filename,
                            restaurantNumber: photo.restaurantNumber,
                            location: photo.location,
                            equipmentType: photo.equipmentType,
                            beforeAfter: photo.beforeAfter,
                            timestamp: photo.timestamp,
                            fileData: null
                        })),
                        timestamp: new Date().toISOString()
                    };
                    localStorage.setItem('wellnessPhotoManager', JSON.stringify(state));
                } catch (error) {
                    console.warn('Failed to save state to localStorage:', error);
                }
            }

            loadState() {
                try {
                    const saved = localStorage.getItem('wellnessPhotoManager');
                    if (saved) {
                        const state = JSON.parse(saved);

                        if (state.formData) {
                            this.restaurantNumber.value = state.formData.restaurantNumber || '';
                            this.location.value = state.formData.location || '';
                            this.equipmentType.value = state.formData.equipmentType || '';
                            this.beforeAfter.value = state.formData.beforeAfter || '';
                        }

                        if (state.photos && Array.isArray(state.photos)) {
                            this.photos = state.photos.filter(photo => photo.filename);
                        }
                    }
                } catch (error) {
                    console.warn('Failed to load state from localStorage:', error);
                    localStorage.removeItem('wellnessPhotoManager');
                }
            }

            clearState() {
                try {
                    localStorage.removeItem('wellnessPhotoManager');
                } catch (error) {
                    console.warn('Failed to clear localStorage:', error);
                }
            }
        }

        // Initialize the app when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new PhotoManager();
        });

        // Register service worker for PWA functionality
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript,console.log("SW registered")');
        }
    </script>
</body>

</html>